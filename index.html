<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ドラクエ風バトルデモ（レイアウト版）</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: "MS Gothic", "Yu Gothic UI", monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    /* 画面全体 */
    #battle-screen {
      width: 640px;
      height: 360px;
      background-color: #000;
      border: 4px solid #fff;
      padding: 8px;
      box-sizing: border-box;
      display: flex;           /* 左右に分割 */
    }

    .window {
      border: 2px solid #fff;
      box-sizing: border-box;
      padding: 8px;
      font-size: 14px;
    }

    /* 左：ステータス画面 */
    #status-area {
      width: 32%;             /* 左は固定幅っぽく */
      margin-right: 8px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }

    #enemy-block {
      margin-bottom: 12px;
      border-bottom: 1px solid #fff;
      padding-bottom: 8px;
    }

    /* 右：ログビュー＋コマンドビュー（縦に分割） */
    #right-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #log-view {
      flex: 1;                /* 上を広くとる */
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
    }

    #message-text {
      white-space: pre-line;
    }

    #command-view {
      height: 80px;           /* 下は少し低く */
      display: flex;
      gap: 8px;
      align-items: stretch;
      justify-content: flex-start;
    }

    .command-btn {
      flex: 0 0 110px;
      padding: 6px 4px;
      background-color: #000;
      color: #fff;
      border: 2px solid #fff;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
    }

    .command-btn:disabled {
      color: #888;
      border-color: #444;
      cursor: default;
    }
  </style>
</head>
<body>
  <div id="battle-screen">
    <!-- 左：ステータス画面 -->
    <div id="status-area" class="window">
      <div id="enemy-block">
        <div>【てき】</div>
        <div id="enemy-name"></div>
        <div id="enemy-hp"></div>
      </div>
      <div id="player-block">
        <div>【ステータス】</div>
        <div id="player-name"></div>
        <div id="player-lv"></div>
        <div id="player-hp"></div>
      </div>
    </div>

    <!-- 右：ログビュー＋コマンドビュー -->
    <div id="right-area">
      <div id="log-view" class="window">
        <div id="message-text"></div>
      </div>

      <div id="command-view" class="window">
        <button id="attack-btn" class="command-btn">たたかう</button>
        <button id="run-btn" class="command-btn">にげる</button>
      </div>
    </div>
  </div>

  <script>
    // ============================
    // データ定義
    // ============================
    const player = {
      name: "やまちゃん",
      level: 1,
      hp: 20,
      maxHp: 20,
      attackMin: 3,
      attackMax: 6
    };

    const enemy = {
      name: "スライム",
      hp: 15,
      maxHp: 15,
      attackMin: 1,
      attackMax: 3
    };

    // "playerTurn" | "enemyTurn" | "win" | "lose" | "escape"
    let gameState = "playerTurn";
    let inputLocked = false;

    // ============================
    // DOM取得
    // ============================
    const enemyNameEl = document.getElementById("enemy-name");
    const enemyHpEl   = document.getElementById("enemy-hp");

    const playerNameEl = document.getElementById("player-name");
    const playerLvEl   = document.getElementById("player-lv");
    const playerHpEl   = document.getElementById("player-hp");

    const messageTextEl = document.getElementById("message-text");

    const attackBtn = document.getElementById("attack-btn");
    const runBtn    = document.getElementById("run-btn");

    // ============================
    // ユーティリティ
    // ============================
    function getRandomDamage(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function updateStatus() {
      enemyNameEl.textContent = enemy.name;
      enemyHpEl.textContent   = "H P : " + enemy.hp + " / " + enemy.maxHp;

      playerNameEl.textContent = player.name;
      playerLvEl.textContent   = "L V : " + player.level;
      playerHpEl.textContent   = "H P : " + player.hp + " / " + player.maxHp;
    }

    function setMessage(lines) {
      if (Array.isArray(lines)) {
        messageTextEl.textContent = lines.join("\n");
      } else {
        messageTextEl.textContent = lines;
      }
    }

    function lockInput() {
      inputLocked = true;
      attackBtn.disabled = true;
      runBtn.disabled    = true;
    }

    function unlockInput() {
      if (gameState === "playerTurn") {
        inputLocked = false;
        attackBtn.disabled = false;
        runBtn.disabled    = false;
      }
    }

    function endBattle() {
      attackBtn.disabled = true;
      runBtn.disabled    = true;
    }

    // ============================
    // 戦闘ロジック
    // ============================
    function playerAttack() {
      if (inputLocked || gameState !== "playerTurn") return;

      lockInput();

      const damage = getRandomDamage(player.attackMin, player.attackMax);
      enemy.hp -= damage;
      if (enemy.hp < 0) enemy.hp = 0;
      updateStatus();

      setMessage([
        player.name + "の こうげき！",
        enemy.name + "に " + damage + " の ダメージ！"
      ]);

      setTimeout(() => {
        if (enemy.hp <= 0) {
          gameState = "win";
          setMessage([
            enemy.name + "を たおした！",
            "けいけんち 5P を かくとく！"
          ]);
          endBattle();
        } else {
          gameState = "enemyTurn";
          enemyAttack();
        }
      }, 800);
    }

    function enemyAttack() {
      if (gameState !== "enemyTurn") return;

      const damage = getRandomDamage(enemy.attackMin, enemy.attackMax);
      player.hp -= damage;
      if (player.hp < 0) player.hp = 0;
      updateStatus();

      setMessage([
        enemy.name + "の こうげき！",
        player.name + "は " + damage + " の ダメージを うけた！"
      ]);

      setTimeout(() => {
        if (player.hp <= 0) {
          gameState = "lose";
          setMessage([
            player.name + "は しんでしまった…",
            "めのまえが まっくらに なった。"
          ]);
          endBattle();
        } else {
          gameState = "playerTurn";
          unlockInput();
          setMessage("コマンド？");
        }
      }, 800);
    }

    function tryEscape() {
      if (inputLocked || gameState !== "playerTurn") return;

      lockInput();

      const escaped = Math.random() < 0.5;

      if (escaped) {
        gameState = "escape";
        setMessage("うまく にげきれた！");
        endBattle();
      } else {
        setMessage([
          "しかし まわりこまれてしまった！",
          enemy.name + "の こうげき！"
        ]);

        setTimeout(() => {
          gameState = "enemyTurn";
          enemyAttack();
        }, 800);
      }
    }

    // ============================
    // イベント設定＆初期化
    // ============================
    attackBtn.addEventListener("click", playerAttack);
    runBtn.addEventListener("click", tryEscape);

    function initBattle() {
      updateStatus();
      setMessage(enemy.name + "が あらわれた！");
      gameState = "playerTurn";
      inputLocked = false;
      attackBtn.disabled = false;
      runBtn.disabled    = false;
    }

    initBattle();
  </script>
</body>
</html>
